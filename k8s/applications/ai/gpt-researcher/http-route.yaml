apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: gpt-researcher
  namespace: gpt-researcher
spec:
  parentRefs:
    - name: external
      namespace: gateway
    - name: internal
      namespace: gateway
  hostnames:
    - 'research.peekoff.com'
  rules:
    # API and WebSocket routes go through the ws-rewriter service
    # which handles URL rewriting for /api/ws -> /ws
    - matches:
        - path:
            type: PathPrefix
            value: /api
      backendRefs:
        - name: ws-rewriter
          namespace: gpt-researcher
          port: 8000
    - matches:
        - path:
            type: Exact
            value: /ws
      backendRefs:
        - name: ws-rewriter
          namespace: gpt-researcher
          port: 8000
    - matches:
        - path:
            type: Exact
            value: /docs
      backendRefs:
        - name: ws-rewriter
          namespace: gpt-researcher
          port: 8000
    - matches:
        - path:
            type: Exact
            value: /openapi.json
      backendRefs:
        - name: ws-rewriter
          namespace: gpt-researcher
          port: 8000
    - matches:
        - path:
            type: PathPrefix
            value: /report
      backendRefs:
        - name: ws-rewriter
          namespace: gpt-researcher
          port: 8000
    - matches:
        - path:
            type: PathPrefix
            value: /upload
      backendRefs:
        - name: ws-rewriter
          namespace: gpt-researcher
          port: 8000
    - matches:
        - path:
            type: PathPrefix
            value: /files
      backendRefs:
        - name: ws-rewriter
          namespace: gpt-researcher
          port: 8000
    # Frontend routes
    - matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - name: gptr-nextjs
          namespace: gpt-researcher
          port: 3000


