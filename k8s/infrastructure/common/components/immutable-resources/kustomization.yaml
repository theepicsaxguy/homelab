apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component

annotations:
  # This ensures we annotate the resources with delete-first policy
  # for resources with immutable fields like selectors
  config.kubernetes.io/local-config: "true"

patches:
- target:
    kind: Deployment
    name: cilium-operator
  patch: |
    - op: add
      path: /metadata/annotations/kustomize.toolkit.fluxcd.io~1reconcile
      value: replace
- target:
    kind: Deployment
    name: hubble-relay
  patch: |
    - op: add
      path: /metadata/annotations/kustomize.toolkit.fluxcd.io~1reconcile
      value: replace
- target:
    kind: Deployment
    name: hubble-ui
  patch: |
    - op: add
      path: /metadata/annotations/kustomize.toolkit.fluxcd.io~1reconcile
      value: replace
- target:
    kind: Deployment
    name: unbound
  patch: |
    - op: add
      path: /metadata/annotations/kustomize.toolkit.fluxcd.io~1reconcile
      value: replace
- target:
    kind: Deployment
    name: kubechecks
  patch: |
    - op: add
      path: /metadata/annotations/kustomize.toolkit.fluxcd.io~1reconcile
      value: replace
- target:
    kind: DaemonSet
    name: cilium
  patch: |
    - op: add
      path: /metadata/annotations/kustomize.toolkit.fluxcd.io~1reconcile
      value: replace
- target:
    kind: DaemonSet
    name: cilium-envoy
  patch: |
    - op: add
      path: /metadata/annotations/kustomize.toolkit.fluxcd.io~1reconcile
      value: replace
