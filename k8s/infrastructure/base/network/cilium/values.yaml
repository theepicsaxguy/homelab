cluster:
  name: talos
  id: 1

kubeProxyReplacement: true

# Essential Talos settings
k8sServiceHost: localhost
k8sServicePort: 7445

# Security context settings consolidated
securityContext:
  privileged: true
  capabilities:
    ciliumAgent:
      [
        'CHOWN',
        'KILL',
        'NET_ADMIN',
        'NET_RAW',
        'IPC_LOCK',
        'SYS_MODULE',
        'SYS_ADMIN',
        'SYS_RESOURCE',
        'DAC_OVERRIDE',
        'FOWNER',
        'SETGID',
        'SETUID',
      ]
  seLinuxOptions:
    level: 's0'
    type: 'spc_t'
  seccompProfile:
    type: RuntimeDefault
  allowPrivilegeEscalation: false

# BGP configuration
bgp:
  enabled: true
  announce:
    loadbalancerIP: true
    podCIDR: true

# Pod security settings
podSecurityContext:
  fsGroup: 1337
  runAsUser: 1337
  runAsGroup: 1337
  runAsNonRoot: true
  seccompProfile:
    type: RuntimeDefault

# Cgroup and BPF settings
cgroup:
  autoMount:
    enabled: false
  hostRoot: /sys/fs/cgroup

bpf:
  masquerade: true
  hostLegacyRouting: false

# IPAM configuration
ipam:
  mode: kubernetes
  operator:
    clusterPoolIPv4PodCIDRList:
      - '${cluster_pod_cidr}'
    clusterPoolIPv4MaskSize: 24

# Operator configuration
operator:
  replicas: 2
  installIpam: true
  installNodesWithoutCilium: true
  removeNodeTaints: true
  skipCRDCreation: false
  resources:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 128Mi

# Resource settings
resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 200m
    memory: 512Mi

# Network and Gateway settings
l2announcements:
  enabled: true

externalIPs:
  enabled: true

enableCiliumEndpointSlice: true

loadBalancer:
  algorithm: maglev
  l7:
    backend: envoy
    secureMode: true

gatewayAPI:
  enabled: true
  secureMode: true
  secretsNamespace:
    name: gateway
    create: true
    sync: true
  enableAlpn: true
  externalTrafficPolicy: Local

# Hubble observability
hubble:
  enabled: true
  relay:
    enabled: true
  ui:
    enabled: true
    service:
      type: ClusterIP

# Authentication and TLS
authentication:
  enabled: true
  mutual:
    spire:
      enabled: true
      install:
        server:
          dataStorage:
            storageClass: longhorn

tls:
  secretsNamespace:
    name: cilium-secrets
    create: true
  forceHTTPS: true
  minTLSVersion: 'VersionTLS13'

# CNI configuration
cni:
  binPath: /opt/cni/bin
  confPath: /etc/cni/net.d

# Host configuration
hostServices:
  enabled: true

hostPorts:
  enabled: true

# Daemon settings
daemon:
  runPath: /var/run/cilium
  mountCgroupFS: false

mountCgroup: false
