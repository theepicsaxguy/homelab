apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: media

resources:
  - http-route.yaml
  - externalsecret.yaml
  - statefulset.yaml
  - svc.yaml

configMapGenerator:
  - name: sabnzbd-env-config
    literals:
      - PUID=2501
      - PGID=2501
      - SAB_DOWNLOAD_DIR=/downloads
      - SAB_INCOMPLETE_DIR=/downloads/incomplete
      - SAB_COMPLETE_DIR=/downloads/complete

      # Explicit folders (keeps UI from ever resetting)
      - SAB__folders__download_dir=/downloads/incomplete
      - SAB__folders__complete_dir=/downloads/complete
      - SAB__folders__nzb_backup_dir=/downloads/nzb-backup

      # Mirror into misc (UI expects these)
      - SAB__misc__download_dir=/downloads/incomplete
      - SAB__misc__complete_dir=/downloads/complete
      - SAB__misc__nzb_backup_dir=/downloads/nzb-backup

      # SAB misc
      - SAB__misc__host_whitelist=sabnzbd,sabnzbd.media,sabnzbd.media.svc,sabnzbd.media.svc.cluster.local,sabnzbd.pc-tips.se
      - SAB__misc__port=8080
      - SAB__folders__nzb_backup_dir=/downloads/nzb-backup

      # SAB servers
      - SAB__servers__newsnewshostingcom__enable=1
      - SAB__servers__newsnewshostingcom__name=newsnewshostingcom
      - SAB__servers__newsnewshostingcom__displayname=news.newshosting.com
      - SAB__servers__newsnewshostingcom__host=news.newshosting.com
      - SAB__servers__newsnewshostingcom__port=563
      - SAB__servers__newsnewshostingcom__timeout=60
      - SAB__servers__newsnewshostingcom__connections=30
      - SAB__servers__newsnewshostingcom__ssl=1
      - SAB__servers__newsnewshostingcom__ssl_verify=3

      # SAB built-in waits (optional but recommended for network storage)
      - SAB__misc__wait_for_dfolder=30
      - SAB__misc__wait_ext_drive=30

      # Entrypoint wait-probe tuning (optional; defaults are fine)
      - SAB_WAIT_PROBE=1
      - SAB_WAIT_TIMEOUT=60
      - SAB_WAIT_INTERVAL=1
      - SAB_WAIT_BACKOFF=1.5
      - SAB_WAIT_MAX_INTERVAL=5
      - SAB_WAIT_DIRS=download_dir,complete_dir,nzb_backup_dir