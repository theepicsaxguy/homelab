apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: bazarr
  namespace: media
spec:
  template:
    spec:
      # Apply pod-level security context for s6-overlay requirements
      securityContext:
        runAsNonRoot: false
        runAsUser: 0
        runAsGroup: 0
        fsGroup: 0 # Needed for volume ownership in some s6-overlay setups
        fsGroupChangePolicy: OnRootMismatch # Keep current behavior
        seccompProfile: # Retain existing seccomp profile
          type: RuntimeDefault
      containers:
        - name: bazarr
          securityContext:
            # Allow privilege escalation for s6-overlay startup scripts
            allowPrivilegeEscalation: true
            # Allow writes to the root filesystem during startup (e.g., /etc)
            readOnlyRootFilesystem: false
            capabilities:
              drop: ["ALL"] # Drop all by default
              add:
                # Capabilities required by s6-overlay for init and permissions handling
                - CHOWN
                - FOWNER
                - SETGID
                - SETUID
