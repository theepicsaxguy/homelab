configs:
  cm:
    create: true
    application.resourceTrackingMethod: annotation+label
    admin.enabled: true
    url: https://argocd.kube.pc-tips.se
    kustomize.buildOptions: "--enable-helm"
  cmp:
    create: true
    plugins:
      kustomize-build-with-helm:
        generate:
          command: [sh, -c]
          args: ["kustomize build --enable-helm"]
  params:
    controller.diff.server.side: true
    server.insecure: true
  rbac:
    policy.csv: |
      g, argocd:admin, role:admin
      g, argocd:read_all, role:readonly

crds:
  install: true
  keep: false

controller:
  resources:
    requests:
      cpu: 100m
      memory: 700Mi
    limits:
      memory: 4Gi

dex:
  enabled: false
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      memory: 128Mi

redis:
  enabled: true
  name: redis
  image:
    repository: public.ecr.aws/docker/library/redis
    tag: 7.4.2-alpine
  resources:
    requests:
      cpu: 100m
      memory: 64Mi
    limits:
      memory: 1Gi
  auth:
    enabled: false
  config:
    save: '""'
  containerSecurityContext:
    readOnlyRootFilesystem: true
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
  service:
    port: 6379
  servicePort: 6379

global:
  image:
    tag: 'v2.9.3'

server:
  service:
    type: LoadBalancer
    annotations:
      io.cilium/lb-ipam-ips: "10.25.150.225"
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      memory: 256Mi
  certificate:
    enabled: true
    domain: argocd.kube.pc-tips.se
    issuer:
      group: cert-manager.io
      kind: ClusterIssuer
      name: cloudflare-cluster-issuer

repoServer:
  containerSecurityContext:
    readOnlyRootFilesystem: true
    allowPrivilegeEscalation: false
    capabilities:
      drop: ["ALL"]
    runAsNonRoot: true
    runAsUser: 999
  volumes:
    - name: custom-tools
      emptyDir: {}
  volumeMounts:
    - mountPath: /usr/local/bin
      name: custom-tools
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      memory: 2Gi
  initContainers:
    - name: plugin-installer
      image: alpine:3.21
      command: [sh, -c]
      args:
        - |
          cp /usr/local/bin/kustomize /usr/local/bin/
          chmod +x /usr/local/bin/kustomize
      securityContext:
        allowPrivilegeEscalation: false
        capabilities:
          drop: ["ALL"]
        runAsNonRoot: true
        runAsUser: 999
        seccompProfile:
          type: RuntimeDefault
      volumeMounts:
        - mountPath: /usr/local/bin
          name: custom-tools
