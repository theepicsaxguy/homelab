apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component

namespace: argo-rollouts

resources:
- rollout-template.yaml
- analysis-template.yaml

vars:
- fieldref:
    fieldpath: data.ROLLOUT_TIMEOUT
  name: ROLLOUT_TIMEOUT
  objref:
    apiVersion: v1
    kind: ConfigMap
    name: base-env-config
- fieldref:
    fieldpath: data.ANALYSIS_DURATION
  name: ANALYSIS_DURATION
  objref:
    apiVersion: v1
    kind: ConfigMap
    name: base-env-config

patches:
- path: rollout-pattern.yaml
  target:
    kind: Rollout
    labelSelector: app.kubernetes.io/part-of=infrastructure

configurations:
- varreference.yaml
