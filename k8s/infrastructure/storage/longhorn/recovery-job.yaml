apiVersion: batch/v1
kind: Job
metadata:
  name: longhorn-recovery
  namespace: longhorn-system
spec:
  ttlSecondsAfterFinished: 3600
  template:
    spec:
      serviceAccountName: longhorn-service-account
      restartPolicy: Never
      containers:
      - name: recovery
        image: bitnami/kubectl:latest
        command:
        - sh
        - -c
        - |
          # Delete stuck longhorn-manager pods to force recreation
          kubectl delete pod -l "app=longhorn-manager" -n longhorn-system --ignore-not-found=true
          echo "Longhorn manager pods recovery initiated"
          sleep 5
