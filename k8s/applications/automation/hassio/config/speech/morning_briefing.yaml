>
  {# Morgonrapport #}
  {%- macro getReport() -%}
    
      {% if now().strftime('%H')|int < 12 and now().strftime('%H')|int > 6 %}
        God morgon.
      {% elif now().strftime('%H')|int >= 12 and now().strftime('%H')|int < 17 %}
        God eftermiddag.
      {% else %}
        God kväll.
      {% endif %}
    
    
      {% if now().strftime('%H')|int < 12 %}
        {% if now().strftime('%M')|int == 0 %}
          Klockan är {{ now().strftime('%H')|int }} på morgonen.
        {% else %}
          Klockan är {{ now().strftime('%H')|int }} och {{ now().strftime('%M')|int }} på morgonen.
        {% endif %}
      {% elif now().strftime('%H')|int > 12 %}
        {% if now().strftime('%M')|int == 0 %}
          Klockan är {{ now().strftime('%H')|int }} på kvällen.
        {% else %}
          Klockan är {{ now().strftime('%H')|int }} och {{ now().strftime('%M')|int }} på kvällen.
        {% endif %}
      {% else %}
      {% endif %}
    
    
      {{ [
        'Idag är det ',
        'Om du inte har hållit reda på det, så är det ',
        'Vet du vilken veckodag det är? Idag är det',
        'Jag vill inte vara budbäraren av dåliga nyheter, men idag är det '
      ]|random }}
      {{states.sensor.today_is_day.state }}.
    
    
      Det är för närvarande {{states.weather.smhi_home.state}} och {{state_attr('weather.smhi_home', 'temperature')}} grader i Halmstad.
    
    
      {{ [
        'Resten av dagen bör vara,',
        'Dagens prognos bör vara,'
      ]|random }}
      {{state_attr('weather.smhi_home', 'forecast')}} 
    
    
      {% if is_state('sensor.today_is_day', 'måndag') %}
        {% if now().strftime('%H')|int > 17 %}
          {{ [ 'Glöm inte att imorgon är det sophämtningsdag. ',
            'Jag rekommenderar att du flyttar sopkärlen till trottoaren för veckans upphämtning. ',
            'Sopor och återvinning ska ut.'
          ] | random }}
        {% endif %}
      {% endif %}
    
    
      {% if is_state('sensor.halloween_countdown','0') %}
        Glad Halloween!
      {% endif %}
      {% if is_state('sensor.christmas_countdown','0') %}
        God jul alla!
      {% endif %}
      {% if is_state('sensor.anniversary_our_wedding','0') %}
        Grattis på årsdagen! Det har varit fantastiska {{ states.sensor.anniversary_our_wedding.attributes.years }} år!
      {% endif %}
      {% if is_state('calendar.holidays_in_united_states', 'on') %}
        Idag är det {{states.calendar.holidays_in_united_states.attributes.message}}.
      {% endif %}
      {% if is_state('calendar.anchorage_holidays', 'on') %}
        Och glöm inte. Idag är det även {{states.calendar.anchorage_holidays.attributes.message}}.
      {% endif %}
      {% if states.calendar.birthdays.state == 'on' %}
        Idag är det {{ states.calendar.birthdays.attributes.message }}! Så grattis på födelsedagen! Konfettikanonen fungerar inte, annars skulle jag duscha dig i pappersskräp som någon annan skulle få plocka upp.
      {% endif %}
      {%- set event=states.calendar.national_holidays.attributes.message %}
      {% if 'Dag' in event and 'National' in event%}
        {{ [
          'Och en mycket speciell glad ',
          'Det är också ',
          'Idag är också känd som ',
          'Åh <emphasis>Titta</emphasis>. Idag är det ',
          'Vill du veta en fakta? Idag är det ',
          'Varje dag kan vara en helgdag. Så idag är det '
        ]|random }}
        {{states.calendar.national_holidays.attributes.message | replace("&"," och ") }}.
        {%- endif -%}
    
  {%- endmacro -%}



  {# a macro that removes all newline characters, empty spaces, and returns formatted text  #}
    {%- macro cleanup(data) -%}
      {%- for item in data.split("\n")  if item | trim != "" -%}
        {{ item | trim }} {% endfor -%}
  {%- endmacro -%}

  {# a macro to call all macros :)  #}
    {%- macro mother_of_all_macros() -%}
      {{ getReport() }}
    {%- endmacro -%}
    
    {# Call the macro  #}
    {{- cleanup(mother_of_all_macros()) -}}