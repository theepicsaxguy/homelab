cluster:
  name: talos
  id: 1

kubeProxyReplacement: true

k8sServiceHost: localhost
k8sServicePort: 7445

# Security Settings
securityContext:
  privileged: true
  capabilities:
    ciliumAgent:
      [
        'CHOWN',
        'KILL',
        'NET_ADMIN',
        'NET_RAW',
        'IPC_LOCK',
        'SYS_MODULE',
        'SYS_ADMIN',
        'SYS_RESOURCE',
        'DAC_OVERRIDE',
        'FOWNER',
        'SETGID',
        'SETUID',
      ]
  seLinuxOptions:
    level: 's0'
    type: 'spc_t'
  seccompProfile:
    type: RuntimeDefault
  allowPrivilegeEscalation: false

podSecurityContext:
  fsGroup: 1337
  runAsUser: 1337
  runAsGroup: 1337
  runAsNonRoot: true
  seccompProfile:
    type: RuntimeDefault

# Webhook Configuration
webhooks:
  enabled: true
  timeoutSeconds: 30
  failurePolicy: Ignore
  retryCount: 3

# Network Settings
ipam:
  mode: kubernetes
  operator:
    clusterPoolIPv4PodCIDRList:
      - '${cluster_pod_cidr}'
    clusterPoolIPv4MaskSize: 24

# Operator Settings
operator:
  replicas: 2
  installIpam: true
  installNodesWithoutCilium: true
  removeNodeTaints: true
  skipCRDCreation: false
  resources:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 128Mi

resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 200m
    memory: 512Mi

# Feature Flags
bpf:
  masquerade: true
  hostLegacyRouting: false

l2announcements:
  enabled: true

externalIPs:
  enabled: true

enableCiliumEndpointSlice: true

# Load Balancer Configuration
loadBalancer:
  algorithm: maglev
  l7:
    backend: envoy
    secureMode: true

# Gateway API Configuration
gatewayAPI:
  enabled: true
  secureMode: true
  secretsNamespace:
    name: gateway
    create: true
    sync: true
  enableAlpn: true
  externalTrafficPolicy: Local
  webhooks:
    timeoutSeconds: 30
    failurePolicy: Ignore

# Observability
hubble:
  enabled: true
  relay:
    enabled: true
  ui:
    enabled: true
    service:
      type: ClusterIP

# Security
authentication:
  enabled: true
  mutual:
    spire:
      enabled: true
      install:
        server:
          dataStorage:
            storageClass: longhorn

tls:
  secretsNamespace:
    name: cilium-secrets
    create: true
  forceHTTPS: true
  minTLSVersion: 'VersionTLS13'

# CNI Settings
cni:
  binPath: /opt/cni/bin
  confPath: /etc/cni/net.d

# Host Configuration
hostServices:
  enabled: true

hostPorts:
  enabled: true

# Daemon Configuration
daemon:
  runPath: /var/run/cilium
  mountCgroupFS: false

# BGP Configuration
bgp:
  enabled: true
  announce:
    loadbalancerIP: true
    podCIDR: true
