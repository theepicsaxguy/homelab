grafana:
  # OIDC Configuration for Authentik
  persistence: {}
  grafana.ini:
    auth.generic_oauth:
      enabled: true
      name: Authentik
      client_id: $__env{GRAFANA_OAUTH_CLIENT_ID}
      client_secret: $__env{GRAFANA_OAUTH_CLIENT_SECRET}
      scopes: openid profile email
      auth_url: https://sso.peekoff.com/application/o/grafana/authorize/
      token_url: https://sso.peekoff.com/application/o/grafana/token/
      api_url: https://sso.peekoff.com/application/o/grafana/userinfo/
      login_attribute_path: preferred_username
      groups_attribute_path: groups
      name_attribute_path: name
      email_attribute_path: email
      role_attribute_path: contains(groups[*], 'Grafana Admins') && 'Admin' || contains(groups[*], 'Grafana Users') && 'Editor' || 'Viewer'
      allow_sign_up: true
      auto_login: false
      use_pkce: true

  # Environment variables from ExternalSecret
  envFromSecrets:
    - name: grafana-oauth-credentials
      optional: false

  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

kubeStateMetrics:
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

prometheusOperator:
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

prometheus:
  prometheusSpec:
    replicas: 1
    topologySpreadConstraints:
      - maxSkew: 1
        topologyKey: kubernetes.io/hostname
        whenUnsatisfiable: ScheduleAnyway
        labelSelector:
          matchLabels:
            prometheus: k8s
    resources:
      requests:
        cpu: 500m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 1Gi
  podDisruptionBudget:
    enabled: false
    minAvailable: 1

alertmanager:
  alertmanagerSpec:
    replicas: 1
    topologySpreadConstraints:
      - maxSkew: 1
        topologyKey: kubernetes.io/hostname
        whenUnsatisfiable: ScheduleAnyway
        labelSelector:
          matchLabels:
            app.kubernetes.io/name: alertmanager
    podDisruptionBudget:
      enabled: false
      minAvailable: 1

prometheus-node-exporter:
  tolerations:
    - key: "gpu"
      operator: "Equal"
      value: "true"
      effect: "NoSchedule"
