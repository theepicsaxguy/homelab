apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component

configMapGenerator:
- name: base-env-config
  behavior: create
  literals:
  - ENVIRONMENT_TYPE=base
  - DEBUG_ENABLED=false
  - LOG_LEVEL=info
  - ENABLE_METRICS=true
  - ENABLE_TRACING=false

patches:
- target:
    kind: Deployment
    labelSelector: app.kubernetes.io/part-of=infrastructure
  patch: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: not-important
    spec:
      template:
        spec:
          containers:
          - name: app
            env:
            - name: ENVIRONMENT
              valueFrom:
                configMapKeyRef:
                  name: base-env-config
                  key: ENVIRONMENT_TYPE
            - name: LOG_LEVEL
              valueFrom:
                configMapKeyRef:
                  name: base-env-config
                  key: LOG_LEVEL
            - name: METRICS_ENABLED
              valueFrom:
                configMapKeyRef:
                  name: base-env-config
                  key: ENABLE_METRICS
