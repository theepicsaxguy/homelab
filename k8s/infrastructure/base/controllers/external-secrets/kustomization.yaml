apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: external-secrets

resources:
- bitwarden-store.yaml
- auth-secret.yaml
- bitwarden-cert.yaml

helmCharts:
  - name: external-secrets
    repo: https://charts.external-secrets.io
    version: 0.14.3
    releaseName: external-secrets
    valuesInline:
      installCRDs: true
      webhook:
        create: true
        port: 443
        hostNetwork: false
        certManager:
          enabled: true
      certController:
        create: true
      bitwarden-sdk-server:
        enabled: true
        image:
          repository: ghcr.io/external-secrets/bitwarden-sdk-server
          tag: "0.3.2"
        service:
          type: ClusterIP
          port: 8087
        tls:
          enabled: true
          autoGenerated: false
          existingSecret: bitwarden-tls-certs

labels:
- includeSelectors: true
  pairs:
    app.kubernetes.io/component: controller
    app.kubernetes.io/instance: external-secrets
    app.kubernetes.io/name: external-secrets

commonAnnotations:
  argocd.argoproj.io/sync-wave: "-1"
