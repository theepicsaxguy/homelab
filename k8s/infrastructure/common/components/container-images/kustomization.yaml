apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component

patches:
# Fix app container image in deployments without testing container name
- target:
    kind: Deployment
    name: (.+)
  patch: |
    - op: add
      path: /spec/template/spec/containers/0/image
      value: busybox:1.36.1
- target:
    kind: DaemonSet
    name: (.+)
  patch: |
    - op: add
      path: /spec/template/spec/containers/0/image
      value: busybox:1.36.1

# Fix specific deployments with missing images
- target:
    kind: Deployment
    name: unbound
  patch: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: unbound
    spec:
      template:
        spec:
          containers:
          - name: unbound
            image: mvance/unbound:1.17.1

- target:
    kind: Deployment
    name: cilium-operator
  patch: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: cilium-operator
    spec:
      template:
        spec:
          containers:
          - name: cilium-operator
            image: quay.io/cilium/operator-generic:v1.17.1@sha256:628becaeb3e4742a1c36c4897721092375891b58bae2bfcae48bbf4420aaee97

- target:
    kind: Deployment
    name: hubble-relay
  patch: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: hubble-relay
    spec:
      template:
        spec:
          containers:
          - name: hubble-relay
            image: quay.io/cilium/hubble-relay:v1.17.1@sha256:397e8fbb188157f744390a7b272a1dec31234e605bcbe22d8919a166d202a3dc

- target:
    kind: Deployment
    name: hubble-ui
  patch: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: hubble-ui
    spec:
      template:
        spec:
          containers:
          - name: frontend
            image: quay.io/cilium/hubble-ui:v0.13.1@sha256:e2e9313eb7caf64b0061d9da0efbdad59c6c461f6ca1752768942bfeda0796c6
          - name: backend
            image: quay.io/cilium/hubble-ui-backend:v0.13.1@sha256:0e0eed917653441fded4e7cdb096b7be6a3bddded5a2dd10812a27b1fc6ed95b
