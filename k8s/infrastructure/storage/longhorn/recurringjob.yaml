# Critical data - GFS (Grandfather-Father-Son) backup rotation
# Provides hourly, daily, and weekly recovery points for databases and stateful apps

# Son tier: Recent recovery points (hourly, 2-day retention)
apiVersion: longhorn.io/v1beta2
kind: RecurringJob
metadata:
  name: backup-gfs-hourly
  namespace: longhorn-system
spec:
  cron: "0 * * * *"  # Every hour
  task: "backup"
  groups:
    - gfs
  retain: 48  # 2 days (48 hourly backups)
  concurrency: 3
  labels:
    strategy: gfs
    tier: son-hourly
---
# Father tier: Medium-term recovery (daily, 2-week retention)
apiVersion: longhorn.io/v1beta2
kind: RecurringJob
metadata:
  name: backup-gfs-daily
  namespace: longhorn-system
spec:
  cron: "0 2 * * *"  # 2 AM daily
  task: "backup"
  groups:
    - gfs
  retain: 14  # 2 weeks
  concurrency: 3
  labels:
    strategy: gfs
    tier: father-daily
---
# Grandfather tier: Long-term archive (weekly, 2-month retention)
apiVersion: longhorn.io/v1beta2
kind: RecurringJob
metadata:
  name: backup-gfs-weekly
  namespace: longhorn-system
spec:
  cron: "0 3 * * 0"  # 3 AM every Sunday
  task: "backup"
  groups:
    - gfs
  retain: 8  # 2 months (8 weekly backups)
  concurrency: 2
  labels:
    strategy: gfs
    tier: grandfather-weekly
---
# Standard tier: Daily backups for non-critical data
apiVersion: longhorn.io/v1beta2
kind: RecurringJob
metadata:
  name: backup-daily
  namespace: longhorn-system
spec:
  cron: "0 2 * * *"  # 2 AM daily
  task: "backup"
  groups:
    - daily
  retain: 14  # 2 weeks
  concurrency: 3
  labels:
    strategy: daily
---
# Basic tier: Weekly backups for least critical data
apiVersion: longhorn.io/v1beta2
kind: RecurringJob
metadata:
  name: backup-weekly
  namespace: longhorn-system
spec:
  cron: "0 3 * * 0"  # 3 AM every Sunday
  task: "backup"
  groups:
    - weekly
  retain: 4  # 1 month (4 weekly backups)
  concurrency: 2
  labels:
    strategy: weekly
---
# Snapshot cleanup - removes temporary snapshots for all backup groups
apiVersion: longhorn.io/v1beta2
kind: RecurringJob
metadata:
  name: snapshot-cleanup
  namespace: longhorn-system
spec:
  cron: "15 */6 * * *"  # Every 6 hours at :15
  task: "snapshot-cleanup"
  groups:
    - gfs
    - daily
    - weekly
  concurrency: 2
  labels:
    type: maintenance
