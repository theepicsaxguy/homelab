apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ns.yaml
helmCharts:
  - name: node-feature-discovery
    repo: https://kubernetes-sigs.github.io/node-feature-discovery/charts
    version: 0.18.3
    releaseName: nfd
    includeCRDs: true
    namespace: node-feature-discovery
    valuesInline:
      worker:
        tolerations:
          - key: "gpu"
            operator: "Equal"
            value: "true"
            effect: "NoSchedule"
        config:
          core:
            sleepInterval: 60s
            featureSources: ["cpu","pci","usb","gpu","system"]
      extraRules:
        - name: nvidia-gpu-rule
          labels:
            nvidia.com/gpu: "true"
          matchFeatures:
            - feature: pci.device
              matchExpressions:
                # Match NVIDIA Corporation vendor ID
                vendor: {op: In, value: ["10de"]}
                # Match VGA compatible controller (0300) or 3D controller (0302)
                class: {op: In, value: ["0300", "0302"]}