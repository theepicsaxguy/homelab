apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: media

resources:
  - http-route.yaml
  - externalsecret.yaml
  - statefulset.yaml
  - svc.yaml

configMapGenerator:
  - name: sabnzbd-env-config
    literals:
      - PUID=2501
      - PGID=2501

      # Base paths (entrypoint still creates/validates)
      - SAB_DOWNLOAD_DIR=/downloads
      - SAB_INCOMPLETE_DIR=/downloads/incomplete
      - SAB_COMPLETE_DIR=/app/data/complete

      # Explicit folders (prevents UI “reset”)
      - SAB__folders__download_dir=/downloads/incomplete
      - SAB__folders__complete_dir=/app/data/complete
      - SAB__folders__nzb_backup_dir=/downloads/nzb-backup

      # Mirror into [misc] because the UI reads these too
      - SAB__misc__download_dir=/downloads/incomplete
      - SAB__misc__complete_dir=/app/data/complete
      - SAB__misc__nzb_backup_dir=/downloads/nzb-backup

      # SAB misc
      - SAB__misc__host_whitelist=sabnzbd,sabnzbd.media,sabnzbd.media.svc,sabnzbd.media.svc.cluster.local,sabnzbd.pc-tips.se
      - SAB__misc__port=8080
      - SAB__misc__pause_on_post_processing=1
      - SAB__misc__wait_for_dfolder=30
      - SAB__misc__wait_ext_drive=30

      # Server (example)
      - SAB__servers__newsnewshostingcom__enable=1
      - SAB__servers__newsnewshostingcom__name=newsnewshostingcom
      - SAB__servers__newsnewshostingcom__displayname=news.newshosting.com
      - SAB__servers__newsnewshostingcom__host=news.newshosting.com
      - SAB__servers__newsnewshostingcom__port=563
      - SAB__servers__newsnewshostingcom__timeout=60
      - SAB__servers__newsnewshostingcom__connections=30
      - SAB__servers__newsnewshostingcom__ssl=1
      - SAB__servers__newsnewshostingcom__ssl_verify=3

      # Entrypoint write-probe (safe defaults)
      - SAB_WAIT_PROBE=1
      - SAB_WAIT_TIMEOUT=60
      - SAB_WAIT_INTERVAL=1
      - SAB_WAIT_BACKOFF=1.5
      - SAB_WAIT_MAX_INTERVAL=5
      - SAB_WAIT_DIRS=download_dir,complete_dir,nzb_backup_dir