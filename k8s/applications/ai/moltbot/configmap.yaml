apiVersion: v1
kind: ConfigMap
metadata:
  name: moltbot-config
  namespace: moltbot
  labels:
    app.kubernetes.io/name: moltbot
data:
  moltbot.json: |
    {
      agents: {
        defaults: {
          workspace: "/workspace",
          model: "litellm/claude-opus-4-5",
          sandbox: {
            mode: "all",
            scope: "session",
            workspaceAccess: "rw",
            docker: {
              image: "moltbot-sandbox:bookworm-slim",
              workdir: "/workspace",
              readOnlyRoot: true,
              tmpfs: ["/tmp", "/var/tmp", "/run"],
              network: "none",
              user: "1000:1000",
              capDrop: ["ALL"],
              env: { LANG: "C.UTF-8" },
              setupCommand: "apt-get update && apt-get install -y git curl jq python3",
              pidsLimit: 256,
              memory: "2g",
              memorySwap: "4g",
              cpus: 1
            },
            prune: {
              idleHours: 24,
              maxAgeDays: 7
            }
          },
          tools: {
            sandbox: {
              tools: {
                allow: ["exec", "process", "read", "write", "edit", "sessions_list", "sessions_history", "sessions_send", "sessions_spawn", "session_status", "browser"],
                deny: ["canvas", "nodes", "cron", "discord", "gateway"]
              }
            }
          }
        },
        list: [
          {
            id: "main",
            default: true,
            identity: {
              name: "Moltbot",
              theme: "helpful assistant",
              emoji: "ðŸ¤–"
            }
          }
        ]
      },
      channels: {
        whatsapp: {
          enabled: true,
          dmPolicy: "pairing",
          allowFrom: ["+15555550123"],
          groups: { "*": { requireMention: true } }
        },
        telegram: {
          enabled: true,
          dmPolicy: "pairing",
          groups: { "*": { requireMention: true } }
        },
        discord: {
          enabled: true,
          guilds: {
            "*": { requireMention: true }
          }
        }
      },
      models: {
        providers: {
          "litellm": {
            baseUrl: "http://litellm.litellm.svc.cluster.local:4000",
            apiKey: "${OPENAI_API_KEY}"
          }
        }
      },
      gateway: {
        port: 18789,
        auth: {
          token: "${CLAWDBOT_GATEWAY_TOKEN}"
        }
      },
      web: {
        enabled: true,
        heartbeatSeconds: 60
      },
      logging: {
        level: "info",
        consoleLevel: "info",
        consoleStyle: "pretty",
        redactSensitive: "tools"
      },
      messages: {
        responsePrefix: "ðŸ¤–",
        ackReaction: "ðŸ‘€",
        ackReactionScope: "group-mentions",
        queue: {
          mode: "collect",
          debounceMs: 1000,
          cap: 20,
          drop: "summarize"
        },
        inbound: {
          debounceMs: 2000
        }
      }
    }